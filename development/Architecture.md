# Исследование архитектурного решения

# Содержание

[1 Архитектура To Be](#1-архитектура-to-be)  
[1.1 Определение типа приложения](#11-определение-типа-приложения)  
[1.2 Выбор стратегии развертывания](#12-выбор-стратегии-развертывания)  
[1.3 Обоснование выбора технологии](#13-обоснование-выбора-технологий)  
[1.4 Показатели качества](#14-показатели-качества)  
[1.5 Пути реализации сквозной функциональности](#15-пути-реализации-сквозной-функциональности)<br>
[1.6 Структурная схема приложения](#16-структурная-схема-приложения)<br>
[2 Архитектура As Is](#2-архитектура-as-is)<br>
[3 Вывод](#3-вывод)

# 1 Архитектура To Be

## 1.1 Определение типа приложения

Выбор соответствующего типа приложения - ключевой момент процессса проектирования приложения. 
Разрабатываемое приложение соответствует типу "Веб-приложения для выполнения преимущественно на сервере в сценариях с постоянным подключением".

## 1.2 Выбор стратегии развертывания

При выборе стратегии необходимо найти компромисс между требованиями приложения и соответствующими схемами развертывания, поддерживаемым оборудованием, и ограничениями, налегаемыми средой на варианты развертывания. Все эти факторы будут влиять на проектируемую архитектуру.<br>
Прежде всего, необходимо определить стратегию развертывания: распределенное или нераспределенное развертывание.
В данном приложении все компоненты приложения разворачиваются на одном центральном сервере, а все данные о пользователях, их коллекциях фильмов и книг хранятся в централизованной базе данных.<br>
Таким образом, нераспределённая стратегия может быть проще в реализации и управлении для разработки небольших проектов.

## 1.3 Обоснование выбора технологий

- Spring Boot
  * Web
  * Devtools
  * Test
  * Security
  * OAuth 2 (для обеспечения безопасности и управления доступом пользователей к приложению)
  * JPA
- Lombok
- PostgreSQL (для хранения информации о пользователях и их коллекциях)
- API Кинопоиска и Google Books (для получения актуальной информации о фильмах и книгах)

Spring Boot поставляется со встроенными серверами приложений (например, Tomcat, Jetty), что облегчает развертывание приложений без необходимости установки и настройки сторонних серверов.<br>
Одним из ключевых преимуществ OAuth является повышенный уровень безопасности. Пользователь предоставляет доступ к своим ресурсам, не раскрывая свои учетные данные третьей стороне.<br>
PostgreSQL стремится к максимальной совместимости с ANSI SQL и имеет широкий спектр функций, позволяющих разработчикам использовать стандартные SQL-запросы и операторы. А также, эта СУБД обеспечивает поддержку транзакций с ACID-свойствами и механизмов контроля целостности данных, что делает ее надежным выбором для критически важных приложений.

## 1.4 Показатели качества

Показатели качества - это свойства системы, отделенные от ее функциональности.
Показатели качества разрабатываемого приложения:

Концептуальная целостность - согласованность и связность дизайна в целом Сюда относится и то, как спроектированы компоненты или модули, и такие факторы как стиль написания кода и именование переменных.

Удобство и простота обслуживания - способность системы изменяться. Это касается изменения компонентов, сервисов, функций и интерфейсов при добавлении или изменении функциональности, исправлении ошибок и реализации новых бизнес-требований.

Доступность - определяет, какую часть времени система функциональна и работает. Доступность может быть измерена как процентное соотношение времени простоя системы за заданный промежуток времени. На доступность оказывают влияние ошибки системы, проблемы инфраструктуры, злонамеренные атаки и нагрузка системы.

Производительность – это показатель, характеризующий скорость, с какой система выполняет любое действие в заданный промежуток времени.

Масштабируемость – это способность системы справляться с увеличением нагрузки без влияния на ее производительность или способность легко расширяться.

Обеспеченность технической поддержкой – это способность системы предоставлять сведения, необходимые для выявления и разрешения проблем при некорректной работе.

Возможность взаимодействия - это способность системы или разных систем успешно работать через взаимодействие и обмен данными с другими внешними системами, созданными и выполняемыми внешними сторонами.

Управляемость - определяет, насколько просто системным администраторам управлять приложением, как правило, посредством достаточного и полезного инструментария, предоставляемого для использования в системах мониторинга, а также для отладки и настройки производительности.

Надежность - это способность системы сохранять работоспособность в течение некоторого времени.

Тестируемость - это мера того, насколько просто создать критерий проверки для системы и ее компонентов и выполнить эти тесты, чтобы определить, отвечает ли система данному критерию.

Удобство и простота использования - определяет, насколько приложение соответствует требованиям пользователя и потребителя с точки зрения понятности, простоты локализации и глобализации, удобства доступа для пользователей с физическими недостатками и обеспечения хорошего взаимодействия с пользователем в общем.

## 1.5 Пути реализации сквозной функциональности

Сквозная функциональность представляет ключевую область дизайна, не связанную с конкретным функционалом приложения.

### Инструментирование и протоколирование

### Аутентификация

В процессе аутентификации пользователей используется механизм аутентификации через Google. 
Пользователь вводит свои учетные данные Google для аутентификации.
После ввода учетных данных происходит проверка подлинности идентификации пользователя через Google OAuth.
В случае успешной аутентификации пользователю предоставляется доступ к приложению, а его аутентифицированные удостоверения передаются между слоями приложения для последующего использования.

### Авторизация

После успешной аутентификации пользователя приложение проверяет его права доступа к различным ресурсам и функциям.
В случае, если пользователь вводит неверные учетные данные или происходит ошибка аутентификации через Google, выводится сообщение о некорректности данных.
Авторизация на каждом уровне приложения обеспечивает необходимую детализацию прав доступа пользователей к ресурсам и функциям приложения в соответствии с их ролями и разрешениями.

### Управление исключениями

Для управления исключениями целесообразнее всего применить стратегию перехвата и повторного формирования исключений.<br>
Когда приложение делает запрос к API Кинопоиска или Google Books, необходимо предусмотреть обработку возможных ошибок, таких как сетевые проблемы, недоступность сервера или некорректный ответ API. После перехвата исключения выполняется логирование ошибки и повторный запрос к API с учтом возможных временных задержек и адекватных интервалов.

### Кэширование

Сервер приложения будет кэшировать посредством распределенной системы кэширования в памяти Memcached ответы от API Кинопоиска и Google Books, чтобы при последующих запросах на ту же информацию можно было обращаться к кэшу, не запрашивая данные снова у API. Memcached использует LRU для вытеснения наименее используемых данных из кэша в случае нехватки места.

## 1.6 Структурная схема приложения

![Структурная схема приложения](https://github.com/SneakyElfff/MoviesAndBooksRecommendationsService/blob/1b6e81714c6769a8b1fd93211ec26b0a8c1f33e3/Development/Deployment%5CComponent%20UML%20Diagram.png)

# 2 Архитектура As Is

В рамках первого Sprint Review были добавлены методы GetMoviesInfo и GetBooksInfo в классы MoviesController и BooksController соответственно.

![Диаграмма классов](https://github.com/SneakyElfff/MoviesAndBooksRecommendationsService/blob/3e0c0d065013c2640141310ae67e6f4e4fb16153/Development/ClassDiagram.png)

# 3 Вывод

## Сравнение архитектур "As is" и "To be"

В ходе сравнения архитектур можно сделать вывод, что они совпадают.
В архитектуре "To be" Web Server состоит из Application и Database. Application в своем составе содержит User Interface и Recommendation Service, Database - User Database. В приложении также используются два сторонних сервера, а именно Kinopoisk.ru Server (компонент Movies Data Base) и Books.Google.com Server (компонент Books Database). 
В архитектуре "As is" Recommendation Service представлен MoviesController и BooksController, которые, в свою очередь, используют InterfaceKinopoisk и InterfaceGoogleBooks для получения информации о фильмах и книгах. User Database представлена в сервере User. 

## Пути улучшения архитектуры

Для улучшения архитектуры следует руководствоваться принциипами проектирования, архитектурными стилями, шаблонами и приемами проектирования.

### Принципы проектирования

Принцип единственной ответственности: разделение классов на более мелкие, каждый из которых отвечает только за одну конкретную задачу, упрощает понимание, тестирование и поддержку кода.

Принцип подстановки Барбары Лисков: объекты в программе должны быть заменяемыми экземплярами их базовых типов, не нарушая функциональность программы. Это позволяет обеспечить гибкость системы и избежать неожиданных поведений при замене объектов различными экземплярами.

### Архитектурные стили и шаблоны

Микросервисная архитектура: разбиение приложения на небольшие сервисы, которые могут быть развернуты и масштабированы независимо друг от друга. Это улучшает производительность и гибкость системы, так как каждый сервис может быть разобран, тестирован и масштабирован отдельно.

### Аудит и рефакторинг

Аудит текущей архитектуры: позволяет выявить недостатки и проблемы в архитектуре системы. Это может включать анализ производительности, безопасности, масштабируемости и гибкости.

Рефакторинг с учетом принципов проектирования: после аудита системы производится изменение кода с целью улучшения его качества (разделение классов, устранение дублирования кода, улучшение читаемости).
